# Файл формы

> Настраиваемый, кросс-браузерный, элемент управления вводом файлов, который поддерживает загрузку одного файла, нескольких файлов и каталогов (для браузеров, поддерживающих режим каталогов).

```html
<template>
  <div>
    <!-- Styled -->
    <b-form-file
      v-model="file1"
      :state="Boolean(file1)"
      placeholder="Choose a file or drop it here..."
      drop-placeholder="Drop file here..."
    ></b-form-file>
    <div class="mt-3">Выбранный файл: {{ file1 ? file1.name : '' }}</div>

    <!-- Plain mode -->
    <b-form-file v-model="file2" class="mt-3" plain></b-form-file>
    <div class="mt-3">Выбранный файл: {{ file2 ? file2.name : '' }}</div>
  </div>
</template>

<script>
  export default {
    data() {
      return {
        file1: null,
        file2: null
      }
    }
  }
</script>

<!-- b-form-file.vue -->
```

Для согласованности между браузерами, `<b-form-file>` по умолчанию используется для ввода пользовательского файла Bootstrap, чтобы заменить настройки браузера по умолчанию. Они построены на основе семантической и доступной разметки, поэтому представляют собой надежную замену вводимым по умолчанию файлам.

## Один файл (по умолчанию)

В однофайловом режиме, когда файл не выбран или пользователь отменяет диалог «Обзор», `v-model` принимает значение `null`, что означает, что файл не выбран. Когда файл выбран, возвращаемое значение будет экземпляром объекта JavaScript [`File`](https://developer.mozilla.org/en/docs/Web/API/File).

## Несколько файлов

Выгрузка нескольких файлов поддерживается добавлением к компоненту свойства `multiple`. В этом случае `v-model` _всегда_ `Array`. Если файлы не выбраны, будет возвращен пустой массив. Когда файл или файлы выбраны, возвращаемое значение будет массивом экземпляров объекта JavaScript [`File`](https://developer.mozilla.org/en/docs/Web/API/File).

## Режим каталога

<div class="alert alert-warning small mb-3">
  <p class="mb-0">
    <strong>ВНИМАНИЕ:</strong> Режим каталога - это <em>нестандартная</em> функция. Несмотря на то, что он поддерживается всеми современными браузерами, на него не следует полагаться в производственной среде.
    Подробнее об <a class="alert-link" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/webkitdirectory">MDN</a> и <a class="alert-link" href="https://caniuse.com/input-file-directory">Могу я использовать</a>.
  </p>
</div>

Добавляя свойство `directory`, пользователь может выбирать каталоги вместо файлов. Когда каталог выбран, каталог и вся его иерархия содержимого включаются в набор выбранных элементов.

В режиме `directory` файлы по умолчанию возвращаются в формате вложенного массива. Т. е.

```
dirA/
  - fileA1
  - fileA2
  - dirB/
    - fileB1
  - dirC/
    - fileC1
    - fileC2
dirD/
  - fileD1
```

будет возвращено как (или аналогичный, порядок файлов/каталогов может отличаться):

```
[[fileA1, fileA2, [fileB1], [fileC1, fileC2]], [fileD1]]
```

Если вы установите свойство `no-traverse`, массив будет сглажен:

```
[fileA1, fileA2, fileB1, fileC1, fileC2, fileD1]
```

Каждая запись файла будет иметь специальную свойство `$path`, которая будет содержать относительный путь к каждому файлу.
Для вложенных структур каталогов BootstrapVue использует свою собственную процедуру для определения относительного пути, в противном случае он полагается на [`File.webkitRelativePath`](https://developer.mozilla.org/en-US/docs/Web/API/File/webkitRelativePath).

Режим каталога также поддерживается, когда ввод файла находится в [режиме `plain`](#non-custom-file-input) в **большинстве** современных браузеров.

## Поддержка перетаскивания

По умолчанию включен режим перетаскивания. Его можно отключить, установив свойство `no-drop`. `no-drop` не действует в [режиме `plain`](#non-custom-file-input) (некоторые браузеры поддерживают перетаскивание файлов в простой входной файл).

При желании вы можете установить другой заполнитель при перетаскивании через свойство `drop-placeholder` или слот `drop-placeholder` с заданной областью действия. Свойство поддерживает только обычный текст. Используйте слот для пользовательской разметки HTML. Слот имеет приоритет над свойством. Свойство/слот `drop-placeholder` не действует, если установлено `no-drop` или в [режиме `plain`](#non-custom-file-input).

Обратите внимание, что собственные ограничения браузера (такие как `required`) не будут работать в режиме перетаскивания, поскольку скрытый ввод файла не обрабатывает функциональность перетаскивания и будет иметь нулевые выбранные файлы.

## Ограничение определенными типами файлов

Вы можете ограничить типы файлов, установив свойство `accept` в строку, содержащую разрешенный тип(ы) файлов. Чтобы указать более одного типа, разделите значения запятой.

```html
<div>
  <!-- Принять все форматы изображений с помощью подстановочного знака типа мультимедиа IANA-->
  <b-form-file accept="image/*"></b-form-file>

  <!-- Принимать определенные форматы изображений по типу IANA -->
  <b-form-file accept="image/jpeg, image/png, image/gif"></b-form-file>

  <!-- Принимать определенные форматы изображений по расширению -->
  <b-form-file accept=".jpg, .png, .gif"></b-form-file>
</div>
```

Чтобы принять файл любого типа, оставьте для параметра `accept` значение `null` (по умолчанию). Вы можете смешивать и сопоставлять типы носителей и расширения IANA.

Смотрите [медиа типы IANA](https://www.iana.org/assignments/media-types/) для получения полного списка стандартных типов носителей.

**Примечание:** Не все браузеры поддерживают или соблюдают атрибут `accept` во входных файлах.

Для перетаскивания BootstrapVue использует внутреннюю процедуру проверки типа файла и отфильтровывает файлы, которые не имеют правильного типа или расширения IANA.

## Кастомизация

`<b-form-file>`, когда он не в [режиме `plain`](#non-custom-file-input), предоставляет несколько функций для настройки его внешнего вида.

### Размеры

Используйте свойство `size` для управления визуальным размером ввода. Размер по умолчанию считается `md` (средний). Дополнительные размеры: `lg` (большой) и `sm` (маленький). Эти размеры совпадают с размерами, доступными в других элементах управления формой.

```html
<div>
  <b-form-group label="Small:" label-cols-sm="2" label-size="sm">
    <b-form-file id="file-small" size="sm"></b-form-file>
  </b-form-group>

  <b-form-group label="Default:" label-cols-sm="2">
    <b-form-file id="file-default"></b-form-file>
  </b-form-group>

  <b-form-group label="Large:" label-cols-sm="2" label-size="lg">
    <b-form-file id="file-large" size="lg"></b-form-file>
  </b-form-group>
</div>

<!-- form-file-sizes.vue -->
```

**Примечание:** Bootstrap v4.x изначально не поддерживает размеры для настраиваемого файлового элемента управления. Однако BootstrapVue включает настраиваемый SCSS/CSS, который добавляет поддержку изменения размера настраиваемого элемента управления вводом файлов.

### Настроить текст заполнителя

Используйте свойство `placeholder` или слот `placeholder` с заданной областью, чтобы изменить текст подсказки, который отображается, когда файлы не выбраны. Свойство поддерживает только обычный текст. Используйте слот для пользовательской разметки HTML. Слот имеет приоритет над свойством.

### Настроить метку кнопки просмотра

Если вы хотите глобально изменить метку `Browse`, вы можете добавить что-то подобное в свои глобальные таблицы стилей. Также рекомендуется использовать [:lang()](https://developer.mozilla.org/en-US/docs/Web/CSS/:lang) для многоязычных сайтов.

```css
.custom-file-input:lang(en) ~ .custom-file-label::after {
  content: 'Browse';
}
```

В качестве альтернативы вы можете установить содержимое пользовательского текста кнопки просмотра файла с помощью свойства `browse-text`. Обратите внимание, поддерживается только обычный текст. HTML и компоненты не поддерживаются.

### Функция форматирования имени файла

Задайте для свойства `file-name-formatter` функцию, которая принимает три аргумента:

| Аргумент             | Тип   | Описание                                                                |
| -------------------- | ----- | ----------------------------------------------------------------------- |
| [1] `files`          | Array | Плоский массив объектов `File`                                          |
| [2] `filesTraversed` | Array | Массив массивов объектов `File` в [режиме `directory`](#directory-mode) |
| [3] `names`          | Array | Плоский массив имен файлов (строк)                                      |

Функция должна возвращать одну отформатированную строку (HTML не поддерживается). Средство форматирования не будет вызываться, если файлы не выбраны.

```html
<template>
  <b-form-file multiple :file-name-formatter="formatNames"></b-form-file>
</template>

<script>
  export default {
    methods: {
      formatNames(files) {
        return files.length === 1 ? files[0].name : `${files.length} files selected`
      }
    }
  }
</script>

<!-- file-formatter-function.vue -->
```

### Форматирование имени файла через слот с заданной областью

В качестве альтернативы вы можете использовать слот с ограниченной областью видимости `file-name` для отображения имен файлов. Слот с заданной областью действия получит следующие свойства:

| Свойство         | Тип   | Описание                                                                |
| ---------------- | ----- | ----------------------------------------------------------------------- |
| `files`          | Array | Плоский массив объектов `File`                                          |
| `filesTraversed` | Array | Массив массивов объектов `File` в [режиме `directory`](#directory-mode) |
| `names`          | Array | Плоский массив имен файлов (строк)                                      |

Все три свойства всегда являются массивами, независимо от настройки свойства `multiple`.

```html
<template>
  <b-form-file multiple>
   <template slot="file-name" slot-scope="{ names }">
     <b-badge variant="dark">{{ names[0] }}</b-badge>
     <b-badge v-if="names.length > 1" variant="dark" class="ml-1">
       + {{ names.length - 1 }} Больше файлов
     </b-badge>
   </template>
  </b-form-file>
</template>

<!-- file-formatter-slot.vue -->
```

При использовании слота `file-name` свойство `file-name-formatter` игнорируется. Слот **не будет** отображаться, если не выбран ни один файл(ы).

## Нестандартный ввод файла

Вы можете сделать так, чтобы `<b-form-file>` отображал исходный файл браузера, установив свойство `plain`. Обратите внимание, что многие из настраиваемых функций не применяются, когда установлен `plain`.

## Контекстная обратная связь о состоянии

Bootstrap включает стили проверки `valid` и `invalid` состояний для большинства элементов управления формой.

Вообще говоря, вы захотите использовать определенное состояние для определенных типов обратной связи:

- `false` (обозначает недопустимое состояние) отлично подходит, когда есть блокирующее или обязательное поле. Пользователь должен правильно заполнить это поле, чтобы отправить форму
- `true` (обозначает допустимое состояние) идеально подходит для ситуаций, когда у вас есть проверка по полю во всей форме и вы хотите побудить пользователя пройти через остальные поля
- `null` diне отображает состояние проверки (ни действительное, ни недействительное)

Чтобы применить один из иконок контекстного состояния к `<b-form-file>`, установите для свойства `state` значение `false` (для недопустимого), `true` (для действительного) или `null` (состояние проверки отсутствует).

**Примечание:** Контекстные состояния **не** поддерживаются в [режиме `plain`](#non-custom-file-input).

## Автофокус

Когда свойство `autofocus` установлено на `<b-form-file>`, ввод будет автоматически сфокусирован, когда он вставлен (т.е. **установлен**) в документ, или повторно активирован, когда он находится внутри Vue. Компонент `<keep-alive>`. Обратите внимание, что это свойство **не** устанавливает атрибут `autofocus` на входе и не может определить, когда ввод становится видимым.

## Доступность

При использовании пользовательской версии ввода `<b-form-file>`, которая скрывает исходный ввод, **настоятельно рекомендуется** указать строку уникального идентификатора документа через свойство `id`. Это автоматически отобразит дополнительные атрибуты ARIA, необходимые для повышения удобства использования людьми, использующими вспомогательные технологии.

## Очистка выбора файла

При вводе типа file обычно `v-model` однонаправлен (это означает, что вы не можете предварительно установить выбранные файлы). Однако вы можете очистить выбранные файлы входного файла, установив для `v-model` значение `null` (для одиночного режима) или пустой массив `[]` (для режимов [`multiple`](#multiple-files)/[`directory`](#directory-mode)).

В качестве альтернативы, `<b-form-file>` предоставляет метод `reset()`, который может быть вызван для очистки ввода файла. Чтобы воспользоваться преимуществом метода `reset()`, вам необходимо получить ссылку на компонент `<b-form-file>`.

```html
<template>
  <div>
    <b-form-file v-model="file" ref="file-input" class="mb-2"></b-form-file>

    <b-button @click="clearFiles" class="mr-2">Сброс с помощью метода</b-button>
    <b-button @click="file = null">Сброс через v-model</b-button>

    <p class="mt-2">Выбранный файл: <b>{{ file ? file.name : '' }}</b></p>
  </div>
</template>

<script>
  export default {
    data() {
      return {
        file: null
      }
    },
    methods: {
      clearFiles() {
        this.$refs['file-input'].reset()
      }
    }
  }
</script>

<!-- b-form-file-reset.vue -->
```

## Примечания по реализации

Поскольку не все браузеры позволяют устанавливать значение входного файла (даже в `null` или пустую строку), `b-form-input` использует технику, которая работает кроссбраузерно, которая включает изменение типа ввода на `null` и затем сразу же вернитесь к типу `file`.

Вложенные файловые структуры в [режим `directory`](#directory-mode) требуют поддержки `Promise` в браузере. Если ваше приложение ориентировано на старые браузеры, такие как IE 11, включите полифилл, который обеспечивает поддержку `Promise`. Если поддержка `Promise` не обнаружена, файлы всегда будут иметь плоскую файловую структуру.

Из-за ["ошибки" в Chromium](https://bugs.chromium.org/p/chromium/issues/detail?id=138987), вложенные файловые структуры в [режиме `directory`](#directory-mode) в настоящее время поддерживаются только тогда, когда каталоги [дропнуты](#drag-and-drop-support) при вводе файла. При выборе их в диалоговом окне «Обзор» они всегда будут иметь структуру плоского массива. Mozilla реализовала поведение [так же, как Chromium](https://bugzilla.mozilla.org/show_bug.cgi?id=1326031).

<!-- Component reference added automatically from component package.json -->
